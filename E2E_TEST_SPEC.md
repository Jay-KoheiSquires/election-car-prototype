# E2Eテスト仕様書

## 1. 概要

### 1.1 目的
選挙カーレンタルプロトタイプのユーザーフロー全体を自動テストし、リリース品質を担保する。

### 1.2 テストフレームワーク
- **Playwright** (Microsoft製E2Eテストフレームワーク)
- クロスブラウザ対応 (Chromium, Firefox, WebKit)
- TypeScriptで記述

### 1.3 テスト環境
- 開発サーバー: `http://localhost:3000`
- Node.js: v18以上

---

## 2. テスト対象ページ

| No | ページ名 | URL | 優先度 | 説明 |
|----|---------|-----|--------|------|
| 1 | シミュレーション | `/` | 高 | 料金計算メイン機能 |
| 2 | お問合せ | `/contact` | 高 | 予約フォーム |
| 3 | FAQ | `/faq` | 中 | よくある質問 |
| 4 | 導入事例 | `/cases` | 中 | 事例紹介 |
| 5 | 活用ガイド | `/guide` | 低 | 使い方ガイド |

---

## 3. テストシナリオ詳細

### 3.1 シミュレーションページ (`/`)

#### TC-SIM-001: ページ初期表示
| 項目 | 内容 |
|------|------|
| 前提条件 | なし |
| テスト手順 | 1. `/`にアクセス |
| 期待結果 | タイトル「料金シミュレーション」が表示される |
| | 選挙区分ボタンが表示される |
| | 合計金額が0より大きい値で表示される |

#### TC-SIM-002: 選挙区分切り替え
| 項目 | 内容 |
|------|------|
| 前提条件 | シミュレーションページを表示 |
| テスト手順 | 1.「統一地方選挙」ボタンをクリック |
| | 2. 合計金額を確認 |
| | 3.「一般地方選挙」ボタンをクリック |
| | 4. 合計金額を確認 |
| 期待結果 | 統一地方選挙の方が一般地方選挙より高い金額が表示される |

#### TC-SIM-003: 車クラス選択
| 項目 | 内容 |
|------|------|
| 前提条件 | シミュレーションページを表示 |
| テスト手順 | 1.「Sクラス」ボタンをクリック |
| | 2. 車種選択が表示されることを確認 |
| | 3.「Lクラス」ボタンをクリック |
| | 4. 車種選択が切り替わることを確認 |
| 期待結果 | 各クラスに対応した車種が表示される |

#### TC-SIM-004: 配送先選択と配送料
| 項目 | 内容 |
|------|------|
| 前提条件 | シミュレーションページを表示 |
| テスト手順 | 1. 配送先で「鳥取県」を選択 |
| | 2. 配送料を確認 |
| | 3. 配送先で「東京都」を選択 |
| | 4. 配送料を確認 |
| 期待結果 | 鳥取県: 配送料「無料」チップ表示 |
| | 東京都: 配送料「¥33,000」表示 |

#### TC-SIM-005: オプション追加
| 項目 | 内容 |
|------|------|
| 前提条件 | シミュレーションページを表示 |
| テスト手順 | 1. 初期合計金額を記録 |
| | 2.「ワイヤレスマイク」チェックボックスをON |
| | 3. 合計金額を確認 |
| 期待結果 | 合計金額が増加している |

#### TC-SIM-006: お問合せ遷移
| 項目 | 内容 |
|------|------|
| 前提条件 | シミュレーションページを表示 |
| テスト手順 | 1.「お問合せ」ボタンをクリック |
| 期待結果 | `/contact`に遷移する |

---

### 3.2 お問合せページ (`/contact`)

#### TC-CON-001: ステップ1 - 選挙種類選択
| 項目 | 内容 |
|------|------|
| 前提条件 | `/contact`にアクセス |
| テスト手順 | 1.「統一地方選挙」カードをクリック |
| 期待結果 | カードが選択状態（ボーダー色変化）になる |
| | 予約タイミングのアラートが表示される |

#### TC-CON-002: ステップ1 - 都道府県選択
| 項目 | 内容 |
|------|------|
| 前提条件 | お問合せページ ステップ1を表示 |
| テスト手順 | 1. 地図から都道府県をクリック（またはリストから選択） |
| 期待結果 | 選択した都道府県名が表示される |

#### TC-CON-003: ステップ移動
| 項目 | 内容 |
|------|------|
| 前提条件 | お問合せページ ステップ1を表示 |
| テスト手順 | 1.「次へ」ボタンをクリック |
| | 2. ステップ2が表示されることを確認 |
| | 3.「戻る」ボタンをクリック |
| 期待結果 | ステップ間を正しく移動できる |

#### TC-CON-004: ステップ2 - 必須項目バリデーション
| 項目 | 内容 |
|------|------|
| 前提条件 | お問合せページ ステップ2を表示 |
| テスト手順 | 1. 何も入力せずに「次へ」をクリック |
| 期待結果 | 必須項目にエラーメッセージが表示される |

#### TC-CON-005: ステップ2 - 郵便番号自動入力
| 項目 | 内容 |
|------|------|
| 前提条件 | お問合せページ ステップ2を表示 |
| テスト手順 | 1. 郵便番号に「100-0001」を入力 |
| | 2. 検索ボタンをクリック |
| 期待結果 | 住所欄に「東京都千代田区千代田」が自動入力される |

#### TC-CON-006: フォーム送信完了
| 項目 | 内容 |
|------|------|
| 前提条件 | 全ステップで有効なデータを入力済み |
| テスト手順 | 1. ステップ4で「送信する」をクリック |
| 期待結果 | 送信処理が完了する |

---

### 3.3 FAQページ (`/faq`)

#### TC-FAQ-001: キーワード検索
| 項目 | 内容 |
|------|------|
| 前提条件 | `/faq`にアクセス |
| テスト手順 | 1. 検索ボックスに「公費負担」と入力 |
| 期待結果 | 公費負担に関するFAQ項目のみ表示される |

#### TC-FAQ-002: カテゴリフィルター
| 項目 | 内容 |
|------|------|
| 前提条件 | FAQページを表示 |
| テスト手順 | 1.「料金・支払い」チップをクリック |
| 期待結果 | 料金・支払いカテゴリのFAQのみ表示される |

#### TC-FAQ-003: アコーディオン開閉
| 項目 | 内容 |
|------|------|
| 前提条件 | FAQページを表示 |
| テスト手順 | 1. FAQ項目をクリック |
| | 2. 再度同じ項目をクリック |
| 期待結果 | クリックで開閉が切り替わる |

---

### 3.4 ナビゲーション

#### TC-NAV-001: ヘッダーメニュー遷移
| 項目 | 内容 |
|------|------|
| 前提条件 | トップページを表示 |
| テスト手順 | 1.「よくある質問」メニューをクリック |
| 期待結果 | `/faq`に遷移する |

#### TC-NAV-002: モバイルメニュー
| 項目 | 内容 |
|------|------|
| 前提条件 | モバイルビューポート (375px) |
| テスト手順 | 1. ハンバーガーメニューをクリック |
| | 2. ドロワーが開くことを確認 |
| | 3. メニュー項目をクリック |
| 期待結果 | ドロワーメニューから各ページに遷移できる |

---

## 4. テストデータ

### 4.1 フォーム入力データ
```typescript
const testData = {
  customer: {
    name: "テスト 太郎",
    furigana: "テスト タロウ",
    postCode: "100-0001",
    address: "東京都千代田区千代田1-1",
    tel: "03-1234-5678",
    email: "test@example.com",
  },
  delivery: {
    date: "2025-04-01",
    time: "10:00",
    location: "office",
  },
};
```

---

## 5. 実行方法

### 5.1 セットアップ
```bash
# Playwrightインストール
npm init playwright@latest

# ブラウザインストール
npx playwright install
```

### 5.2 テスト実行
```bash
# 全テスト実行
npx playwright test

# UIモードで実行（デバッグ用）
npx playwright test --ui

# 特定ファイル実行
npx playwright test e2e/simulation.spec.ts

# ヘッドフルモード（ブラウザ表示）
npx playwright test --headed
```

### 5.3 レポート確認
```bash
npx playwright show-report
```

---

## 6. 成功基準

- 全テストケースがパス
- 主要ユーザーフロー（シミュレーション → お問合せ）が正常動作
- レスポンシブ対応（デスクトップ・モバイル）
- クロスブラウザ（Chromium, Firefox, WebKit）
